"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{2833:(e,t,r)=>{r.d(t,{Df:()=>tT});var a,n,o,s,i,l,u,p,c,m,d,h,f,g,y,v,b=r(8701),x=r(3122),w=r(1172),z=r(1719),T=r(2667),S=r(1506),I=Object.defineProperty,j=(e,t)=>{for(var r in t)I(e,r,{get:t[r],enumerable:!0})};function R(e,{contentType:t,dataStreamVersion:r}){let a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}function _(e,{contentType:t,dataStreamVersion:r}){let a={};if(null!=e)for(let[t,r]of Object.entries(e))a[t]=r;return null==a["Content-Type"]&&(a["Content-Type"]=t),void 0!==r&&(a["X-Vercel-AI-Data-Stream"]=r),a}function M({response:e,status:t,statusText:r,headers:a,stream:n}){e.writeHead(null!=t?t:200,r,a);let o=n.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await o.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var k="AI_InvalidArgumentError",C=`vercel.ai.error.${k}`,E=Symbol.for(C),A=class extends b.bD{constructor({parameter:e,value:t,message:r}){super({name:k,message:`Invalid argument for parameter ${e}: ${r}`}),this[a]=!0,this.parameter=e,this.value=t}static isInstance(e){return b.bD.hasMarker(e,C)}};a=E;var O="AI_RetryError",N=`vercel.ai.error.${O}`,D=Symbol.for(N),P=class extends b.bD{constructor({message:e,reason:t,errors:r}){super({name:O,message:e}),this[n]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return b.bD.hasMarker(e,N)}};n=D;var $=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>U(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function U(e,{maxRetries:t,delayInMs:r,backoffFactor:a},n=[]){try{return await e()}catch(l){if((0,x.zf)(l)||0===t)throw l;let o=(0,x.u1)(l),s=[...n,l],i=s.length;if(i>t)throw new P({message:`Failed after ${i} attempts. Last error: ${o}`,reason:"maxRetriesExceeded",errors:s});if(l instanceof Error&&b.hL.isInstance(l)&&!0===l.isRetryable&&i<=t)return await (0,x.cb)(r),U(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},s);if(1===i)throw l;throw new P({message:`Failed after ${i} attempts with non-retryable error: '${o}'`,reason:"errorNotRetryable",errors:s})}}function q({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new A({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new A({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:$({maxRetries:t})}}function J({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function F({model:e,settings:t,telemetry:r,headers:a}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var L={startSpan:()=>V,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(V):"function"==typeof r?r(V):"function"==typeof a?a(V):void 0},V={spanContext:()=>B,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},B={traceId:"",spanId:"",traceFlags:0};function Z({isEnabled:e=!1,tracer:t}={}){return e?t||w.u.getTracer("ai"):L}function K({name:e,tracer:t,attributes:r,fn:a,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return n&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:z.s.ERROR,message:t.message})):e.setStatus({code:z.s.ERROR})}finally{e.end()}throw t}})}function G({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=a.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=a.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:a}},{})}var W="AI_NoImageGeneratedError",H=`vercel.ai.error.${W}`,X=Symbol.for(H);b.bD,o=X;var Q=class{constructor({data:e,mimeType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,x.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,x.Z9)(this.base64Data)),this.uint8ArrayData}},Y=class extends Q{constructor(e){super(e),this.type="file"}},ee=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],et=e=>{let t="string"==typeof e?(0,x.Z9)(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)},er="AI_NoObjectGeneratedError",ea=`vercel.ai.error.${er}`,en=Symbol.for(ea),eo=class extends b.bD{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:n,finishReason:o}){super({name:er,message:e,cause:t}),this[s]=!0,this.text=r,this.response=a,this.usage=n,this.finishReason=o}static isInstance(e){return b.bD.hasMarker(e,ea)}};s=en;var es="AI_DownloadError",ei=`vercel.ai.error.${es}`,el=Symbol.for(ei),eu=class extends b.bD{constructor({url:e,statusCode:t,statusText:r,cause:a,message:n=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:es,message:n,cause:a}),this[i]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return b.bD.hasMarker(e,ei)}};async function ep({url:e}){var t;let r=e.toString();try{let e=await fetch(r);if(!e.ok)throw new eu({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(eu.isInstance(e))throw e;throw new eu({url:r,cause:e})}}i=el;var ec="AI_InvalidDataContentError",em=`vercel.ai.error.${ec}`,ed=Symbol.for(em),eh=class extends b.bD{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:ec,message:r,cause:t}),this[l]=!0,this.content=e}static isInstance(e){return b.bD.hasMarker(e,em)}};l=ed;var ef=T.z.union([T.z.string(),T.z.instanceof(Uint8Array),T.z.instanceof(ArrayBuffer),T.z.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function eg(e){return"string"==typeof e?e:e instanceof ArrayBuffer?(0,x.n_)(new Uint8Array(e)):(0,x.n_)(e)}function ey(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return(0,x.Z9)(e)}catch(t){throw new eh({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new eh({content:e})}var ev="AI_InvalidMessageRoleError",eb=`vercel.ai.error.${ev}`,ex=Symbol.for(eb),ew=class extends b.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ev,message:t}),this[u]=!0,this.role=e}static isInstance(e){return b.bD.hasMarker(e,eb)}};async function ez({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=ep}){let n=await eT(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,a,n,o,s,i;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,a,n,o;let s,i,l;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let u=e.mimeType,p=e.type;switch(p){case"image":s=e.image;break;case"file":s=e.data;break;default:throw Error(`Unsupported part type: ${p}`)}try{i="string"==typeof s?new URL(s):s}catch(e){i=s}if(i instanceof URL){if("data:"===i.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(i.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${p}`);u=e,l=ey(t)}else{let e=t[i.toString()];e?(l=e.data,null!=u||(u=e.mimeType)):l=i}}else l=ey(i);switch(p){case"image":return l instanceof Uint8Array&&(u=null!=(a=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?et(e):e;for(let e of t)if("string"==typeof r?r.startsWith(e.base64Prefix):r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>r[t]===e))return e.mimeType}({data:l,signatures:ee}))?a:u),{type:"image",image:l,mimeType:u,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"file":if(null==u)throw Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?eg(l):l,filename:e.filename,mimeType:u,providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{var t;let r=null!=(t=e.providerOptions)?t:e.experimental_providerMetadata;switch(e.type){case"file":return{type:"file",data:e.data instanceof URL?e.data:eg(e.data),filename:e.filename,mimeType:e.mimeType,providerMetadata:r};case"reasoning":return{type:"reasoning",text:e.text,signature:e.signature,providerMetadata:r};case"redacted-reasoning":return{type:"redacted-reasoning",data:e.data,providerMetadata:r};case"text":return{type:"text",text:e.text,providerMetadata:r};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,providerMetadata:r}}}),providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};default:throw new ew({role:l})}})(e,n))]}async function eT(e,t,r,a){let n=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>"image"!==e.type||!0!==r).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(n.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function eS({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:n,frequencyPenalty:o,stopSequences:s,seed:i}){if(null!=e){if(!Number.isInteger(e))throw new A({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new A({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new A({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new A({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new A({parameter:"topK",value:a,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new A({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=o&&"number"!=typeof o)throw new A({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(null!=i&&!Number.isInteger(i))throw new A({parameter:"seed",value:i,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:n,frequencyPenalty:o,stopSequences:null!=s&&s.length>0?s:void 0,seed:i}}function eI(e){var t,r,a;let n=[];for(let o of e){let e;try{e=new URL(o.url)}catch(e){throw Error(`Invalid URL: ${o.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=o.contentType)?void 0:t.startsWith("image/"))n.push({type:"image",image:e});else{if(!o.contentType)throw Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:e,mimeType:o.contentType})}break;case"data:":{let e,t,s;try{[e,t]=o.url.split(","),s=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${o.url}`)}if(null==s||null==t)throw Error(`Invalid data URL format: ${o.url}`);if(null==(r=o.contentType)?void 0:r.startsWith("image/"))n.push({type:"image",image:ey(t)});else if(null==(a=o.contentType)?void 0:a.startsWith("text/"))n.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(ey(t))});else{if(!o.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:t,mimeType:o.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return n}u=ex;var ej="AI_MessageConversionError",eR=`vercel.ai.error.${ej}`,e_=Symbol.for(eR),eM=class extends b.bD{constructor({originalMessage:e,message:t}){super({name:ej,message:t}),this[p]=!0,this.originalMessage=e}static isInstance(e){return b.bD.hasMarker(e,eR)}};function ek(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}p=e_;var eC=T.z.lazy(()=>T.z.union([T.z.null(),T.z.string(),T.z.number(),T.z.boolean(),T.z.record(T.z.string(),eC),T.z.array(eC)])),eE=T.z.record(T.z.string(),T.z.record(T.z.string(),eC)),eA=T.z.array(T.z.union([T.z.object({type:T.z.literal("text"),text:T.z.string()}),T.z.object({type:T.z.literal("image"),data:T.z.string(),mimeType:T.z.string().optional()})])),eO=T.z.object({type:T.z.literal("text"),text:T.z.string(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eN=T.z.object({type:T.z.literal("image"),image:T.z.union([ef,T.z.instanceof(URL)]),mimeType:T.z.string().optional(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eD=T.z.object({type:T.z.literal("file"),data:T.z.union([ef,T.z.instanceof(URL)]),filename:T.z.string().optional(),mimeType:T.z.string(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eP=T.z.object({type:T.z.literal("reasoning"),text:T.z.string(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),e$=T.z.object({type:T.z.literal("redacted-reasoning"),data:T.z.string(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eU=T.z.object({type:T.z.literal("tool-call"),toolCallId:T.z.string(),toolName:T.z.string(),args:T.z.unknown(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eq=T.z.object({type:T.z.literal("tool-result"),toolCallId:T.z.string(),toolName:T.z.string(),result:T.z.unknown(),content:eA.optional(),isError:T.z.boolean().optional(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eJ=T.z.object({role:T.z.literal("system"),content:T.z.string(),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eF=T.z.object({role:T.z.literal("user"),content:T.z.union([T.z.string(),T.z.array(T.z.union([eO,eN,eD]))]),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eL=T.z.object({role:T.z.literal("assistant"),content:T.z.union([T.z.string(),T.z.array(T.z.union([eO,eD,eP,e$,eU]))]),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eV=T.z.object({role:T.z.literal("tool"),content:T.z.array(eq),providerOptions:eE.optional(),experimental_providerMetadata:eE.optional()}),eB=T.z.union([eJ,eF,eL,eV]);function eZ({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new b.M3({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new b.M3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new b.M3({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new b.M3({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(ek);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new b.M3({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let a="ui-messages"===r?function(e,t){var r,a;let n=null!=(r=null==t?void 0:t.tools)?r:{},o=[];for(let t=0;t<e.length;t++){let r=e[t],s=t===e.length-1,{role:i,content:l,experimental_attachments:u}=r;switch(i){case"system":o.push({role:"system",content:l});break;case"user":if(null==r.parts)o.push({role:"user",content:u?[{type:"text",text:l},...eI(u)]:l});else{let e=r.parts.filter(e=>"text"===e.type).map(e=>({type:"text",text:e.text}));o.push({role:"user",content:u?[...e,...eI(u)]:e})}break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of i)switch(t.type){case"file":case"text":e.push(t);break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}o.push({role:"assistant",content:e});let a=i.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);a.length>0&&o.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new eM({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:o}=e,s=n[a];return(null==s?void 0:s.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:s.experimental_toToolResultContent(o),experimental_content:s.experimental_toToolResultContent(o)}:{type:"tool-result",toolCallId:t,toolName:a,result:o}})}),i=[],s=!1,t++},t=0,s=!1,i=[];for(let n of r.parts)switch(n.type){case"text":s&&e(),i.push(n);break;case"file":case"reasoning":i.push(n);break;case"tool-invocation":(null!=(a=n.toolInvocation.step)?a:0)!==t&&e(),i.push(n),s=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){o.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let a=0;a<=t;a++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===a});0!==t.length&&(o.push({role:"assistant",content:[...s&&l&&0===a?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),o.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new eM({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:o}=e,s=n[a];return(null==s?void 0:s.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:s.experimental_toToolResultContent(o),experimental_content:s.experimental_toToolResultContent(o)}:{type:"tool-result",toolCallId:t,toolName:a,result:o}})}))}l&&!s&&o.push({role:"assistant",content:l});break}case"data":break;default:throw new eM({originalMessage:r,message:`Unsupported role: ${i}`})}}return o}(e.messages,{tools:t}):e.messages;if(0===a.length)throw new b.M3({prompt:e,message:"messages must not be empty"});let n=(0,x.ZZ)({value:a,schema:T.z.array(eB)});if(!n.success)throw new b.M3({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:n.error});return{type:"messages",messages:a,system:e.system}}throw Error("unreachable")}function eK({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function eG(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}function eW({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:a=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter(e=>null!=e).join("\n")}function eH(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}var eX={type:"no-schema",jsonSchema:void 0,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:(e,t)=>void 0===e?{success:!1,error:new eo({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new b.b8({functionality:"element streams in no-schema mode"})}},eQ=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:t=>safeValidateTypes2({value:t,schema:e}),createElementStream(){throw new UnsupportedFunctionalityError({functionality:"element streams in object mode"})}}),eY=e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},validatePartialResult({value:t,latestObject:r,isFirstDelta:a,isFinalDelta:n}){var o;if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let s=t.elements,i=[];for(let t=0;t<s.length;t++){let r=safeValidateTypes2({value:s[t],schema:e});if(t!==s.length-1||n){if(!r.success)return r;i.push(r.value)}}let l=null!=(o=null==r?void 0:r.length)?o:0,u="";return a&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),n&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},validateFinalResult(t){if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=safeValidateTypes2({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return eH(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let a=e.object;for(;t<a.length;t++)r.enqueue(a[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},e0=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},validateFinalResult(t){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new TypeValidationError({value:t,cause:"value must be a string in the enum"})}},validatePartialResult(){throw new UnsupportedFunctionalityError({functionality:"partial results in enum mode"})},createElementStream(){throw new UnsupportedFunctionalityError({functionality:"element streams in enum mode"})}});(0,x.hK)({prefix:"aiobj",size:24});var e1=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function e2(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function e4(){let e=[],t=null,r=!1,a=e2(),n=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=e2(),await a.promise,n();try{let{value:a,done:o}=await e[0].read();o?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(a){null==t||t.error(a),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}(0,x.hK)({prefix:"aiobj",size:24});var e7="AI_NoOutputSpecifiedError",e6=`vercel.ai.error.${e7}`,e8=Symbol.for(e6),e3=class extends b.bD{constructor({message:e="No output specified."}={}){super({name:e7,message:e}),this[c]=!0}static isInstance(e){return b.bD.hasMarker(e,e6)}};c=e8;var e9="AI_ToolExecutionError",e5=`vercel.ai.error.${e9}`,te=Symbol.for(e5),tt=class extends b.bD{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:n=`Error executing tool ${t}: ${(0,b.u1)(a)}`}){super({name:e9,message:n,cause:a}),this[m]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return b.bD.hasMarker(e,e5)}};function tr({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:(0,S.mD)(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}m=te;var ta=/^([\s\S]*?)(\s+)(\S*)$/;function tn(e){let t=e.match(ta);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}var to="AI_InvalidToolArgumentsError",ts=`vercel.ai.error.${to}`,ti=Symbol.for(ts),tl=class extends b.bD{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${(0,b.u1)(r)}`}){super({name:to,message:a,cause:r}),this[d]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return b.bD.hasMarker(e,ts)}};d=ti;var tu="AI_NoSuchToolError",tp=`vercel.ai.error.${tu}`,tc=Symbol.for(tp),tm=class extends b.bD{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:tu,message:r}),this[h]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return b.bD.hasMarker(e,tp)}};h=tc;var td="AI_ToolCallRepairError",th=`vercel.ai.error.${td}`,tf=Symbol.for(th),tg=class extends b.bD{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${(0,b.u1)(e)}`}){super({name:td,message:r,cause:e}),this[f]=!0,this.originalError=t}static isInstance(e){return b.bD.hasMarker(e,th)}};async function ty({toolCall:e,tools:t,repairToolCall:r,system:a,messages:n}){if(null==t)throw new tm({toolName:e.toolName});try{return await tv({toolCall:e,tools:t})}catch(s){if(null==r||!(tm.isInstance(s)||tl.isInstance(s)))throw s;let o=null;try{o=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>(0,S.mD)(t[e].parameters).jsonSchema,system:a,messages:n,error:s})}catch(e){throw new tg({cause:e,originalError:s})}if(null==o)throw s;return await tv({toolCall:o,tools:t})}}async function tv({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new tm({toolName:e.toolName,availableTools:Object.keys(t)});let n=(0,S.mD)(a.parameters),o=""===e.args.trim()?(0,x.ZZ)({value:{},schema:n}):(0,x.N8)({text:e.args,schema:n});if(!1===o.success)throw new tl({toolName:r,toolArgs:e.args,cause:o.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:o.value}}function tb(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}function tx({text:e="",files:t,reasoning:r,tools:a,toolCalls:n,toolResults:o,messageId:s,generateMessageId:i}){let l=[],u=[];return r.length>0&&u.push(...r.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"})),t.length>0&&u.push(...t.map(e=>({type:"file",data:e.base64,mimeType:e.mimeType}))),e.length>0&&u.push({type:"text",text:e}),n.length>0&&u.push(...n),u.length>0&&l.push({role:"assistant",content:u,id:s}),o.length>0&&l.push({role:"tool",id:i(),content:o.map(e=>{let t=a[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),l}f=tf;var tw=(0,x.hK)({prefix:"aitxt",size:24}),tz=(0,x.hK)({prefix:"msg",size:24});async function tT({model:e,tools:t,toolChoice:r,system:a,prompt:n,messages:o,maxRetries:s,abortSignal:i,headers:l,maxSteps:u=1,experimental_generateMessageId:p=tz,experimental_output:c,experimental_continueSteps:m=!1,experimental_telemetry:d,experimental_providerMetadata:h,providerOptions:f=h,experimental_activeTools:g,experimental_prepareStep:y,experimental_repairToolCall:v,_internal:{generateId:b=tw,currentDate:x=()=>new Date}={},onStepFinish:w,...z}){var T;if(u<1)throw new A({parameter:"maxSteps",value:u,message:"maxSteps must be at least 1"});let{maxRetries:S,retry:I}=q({maxRetries:s}),j=F({model:e,telemetry:d,headers:l,settings:{...z,maxRetries:S}}),R=eZ({prompt:{system:null!=(T=null==c?void 0:c.injectIntoSystemPrompt({system:a,model:e}))?T:a,prompt:n,messages:o},tools:t}),_=Z(d);return K({name:"ai.generateText",attributes:G({telemetry:d,attributes:{...J({operationId:"ai.generateText",telemetry:d}),...j,"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:n,messages:o})},"ai.settings.maxSteps":u}}),tracer:_,fn:async n=>{var o,s,h,T,S,M,k,C,E,A,O,N,D,P;let $;let U=eS(z),q=[],F=[],L=[],V=0,B=[],Z="",W=[],H=[],X={completionTokens:0,promptTokens:0,totalTokens:0},Q="initial";do{let n=0===V?R.type:"messages",N=[...R.messages,...B],D=await (null==y?void 0:y({model:e,steps:H,maxSteps:u,stepNumber:V})),P=null!=(o=null==D?void 0:D.toolChoice)?o:r,Y=null!=(s=null==D?void 0:D.experimental_activeTools)?s:g,ee=null!=(h=null==D?void 0:D.model)?h:e,et=await ez({prompt:{type:n,system:R.system,messages:N},modelSupportsImageUrls:ee.supportsImageUrls,modelSupportsUrl:null==(T=ee.supportsUrl)?void 0:T.bind(ee)}),er={type:"regular",...tr({tools:t,toolChoice:P,activeTools:Y})};$=await I(()=>K({name:"ai.generateText.doGenerate",attributes:G({telemetry:d,attributes:{...J({operationId:"ai.generateText.doGenerate",telemetry:d}),...j,"ai.model.provider":ee.provider,"ai.model.id":ee.modelId,"ai.prompt.format":{input:()=>n},"ai.prompt.messages":{input:()=>JSON.stringify(et)},"ai.prompt.tools":{input:()=>{var e;return null==(e=er.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=er.toolChoice?JSON.stringify(er.toolChoice):void 0},"gen_ai.system":ee.provider,"gen_ai.request.model":ee.modelId,"gen_ai.request.frequency_penalty":z.frequencyPenalty,"gen_ai.request.max_tokens":z.maxTokens,"gen_ai.request.presence_penalty":z.presencePenalty,"gen_ai.request.stop_sequences":z.stopSequences,"gen_ai.request.temperature":z.temperature,"gen_ai.request.top_k":z.topK,"gen_ai.request.top_p":z.topP}}),tracer:_,fn:async t=>{var r,a,o,s,u,p;let m=await ee.doGenerate({mode:er,...U,inputFormat:n,responseFormat:null==c?void 0:c.responseFormat({model:e}),prompt:et,providerMetadata:f,abortSignal:i,headers:l}),h={id:null!=(a=null==(r=m.response)?void 0:r.id)?a:b(),timestamp:null!=(s=null==(o=m.response)?void 0:o.timestamp)?s:x(),modelId:null!=(p=null==(u=m.response)?void 0:u.modelId)?p:ee.modelId};return t.setAttributes(G({telemetry:d,attributes:{"ai.response.finishReason":m.finishReason,"ai.response.text":{output:()=>m.text},"ai.response.toolCalls":{output:()=>JSON.stringify(m.toolCalls)},"ai.response.id":h.id,"ai.response.model":h.modelId,"ai.response.timestamp":h.timestamp.toISOString(),"ai.usage.promptTokens":m.usage.promptTokens,"ai.usage.completionTokens":m.usage.completionTokens,"gen_ai.response.finish_reasons":[m.finishReason],"gen_ai.response.id":h.id,"gen_ai.response.model":h.modelId,"gen_ai.usage.input_tokens":m.usage.promptTokens,"gen_ai.usage.output_tokens":m.usage.completionTokens}})),{...m,response:h}}})),q=await Promise.all((null!=(S=$.toolCalls)?S:[]).map(e=>ty({toolCall:e,tools:t,repairToolCall:v,system:a,messages:N}))),F=null==t?[]:await tS({toolCalls:q,tools:t,tracer:_,telemetry:d,messages:N,abortSignal:i});let ea=eK($.usage);X=eG(X,ea);let en="done";++V<u&&(m&&"length"===$.finishReason&&0===q.length?en="continue":q.length>0&&F.length===q.length&&(en="tool-result"));let eo=null!=(M=$.text)?M:"",es="continue"===Q&&Z.trimEnd()!==Z?eo.trimStart():eo,ei="continue"===en?function(e){let t=tn(e);return t?t.prefix+t.whitespace:e}(es):es;if(Z="continue"===en||"continue"===Q?Z+ei:ei,L=tj($.reasoning),W.push(...null!=(k=$.sources)?k:[]),"continue"===Q){let e=B[B.length-1];"string"==typeof e.content?e.content+=ei:e.content.push({text:ei,type:"text"})}else B.push(...tx({text:Z,files:tR($.files),reasoning:tj($.reasoning),tools:null!=t?t:{},toolCalls:q,toolResults:F,messageId:p(),generateMessageId:p}));let el={stepType:Q,text:ei,reasoning:tb(L),reasoningDetails:L,files:tR($.files),sources:null!=(C=$.sources)?C:[],toolCalls:q,toolResults:F,finishReason:$.finishReason,usage:ea,warnings:$.warnings,logprobs:$.logprobs,request:null!=(E=$.request)?E:{},response:{...$.response,headers:null==(A=$.rawResponse)?void 0:A.headers,body:null==(O=$.rawResponse)?void 0:O.body,messages:structuredClone(B)},providerMetadata:$.providerMetadata,experimental_providerMetadata:$.providerMetadata,isContinued:"continue"===en};H.push(el),await (null==w?void 0:w(el)),Q=en}while("done"!==Q);return n.setAttributes(G({telemetry:d,attributes:{"ai.response.finishReason":$.finishReason,"ai.response.text":{output:()=>$.text},"ai.response.toolCalls":{output:()=>JSON.stringify($.toolCalls)},"ai.usage.promptTokens":$.usage.promptTokens,"ai.usage.completionTokens":$.usage.completionTokens}})),new tI({text:Z,files:tR($.files),reasoning:tb(L),reasoningDetails:L,sources:W,outputResolver:()=>{if(null==c)throw new e3;return c.parseOutput({text:Z},{response:$.response,usage:X,finishReason:$.finishReason})},toolCalls:q,toolResults:F,finishReason:$.finishReason,usage:X,warnings:$.warnings,request:null!=(N=$.request)?N:{},response:{...$.response,headers:null==(D=$.rawResponse)?void 0:D.headers,body:null==(P=$.rawResponse)?void 0:P.body,messages:B},logprobs:$.logprobs,steps:H,providerMetadata:$.providerMetadata})}})}async function tS({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:n,abortSignal:o}){return(await Promise.all(e.map(async({toolCallId:e,toolName:s,args:i})=>{let l=t[s];if((null==l?void 0:l.execute)==null)return;let u=await K({name:"ai.toolCall",attributes:G({telemetry:a,attributes:{...J({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":s,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(i)}}}),tracer:r,fn:async t=>{try{let r=await l.execute(i,{toolCallId:e,messages:n,abortSignal:o});try{t.setAttributes(G({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}catch(t){throw new tt({toolCallId:e,toolName:s,toolArgs:i,cause:t})}}});return{type:"tool-result",toolCallId:e,toolName:s,args:i,result:u}}))).filter(e=>null!=e)}var tI=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function tj(e){return null==e?[]:"string"==typeof e?[{type:"text",text:e}]:e}function tR(e){var t;return null!=(t=null==e?void 0:e.map(e=>new Q(e)))?t:[]}j({},{object:()=>tD,text:()=>tN});var t_="AI_InvalidStreamPartError",tM=`vercel.ai.error.${t_}`,tk=Symbol.for(tM),tC=class extends b.bD{constructor({chunk:e,message:t}){super({name:t_,message:t}),this[g]=!0,this.chunk=e}static isInstance(e){return b.bD.hasMarker(e,tM)}};g=tk;var tE="vercel.ai.error.AI_MCPClientError",tA=Symbol.for(tE),tO=class extends b.bD{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[y]=!0}static isInstance(e){return b.bD.hasMarker(e,tE)}};y=tA;var tN=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),tD=({schema:e})=>{let t=(0,S.mD)(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:eW({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=(0,S.d1)(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let a=(0,x.N8)({text:e});if(!a.success)throw new eo({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=(0,x.ZZ)({value:a.value,schema:t});if(!n.success)throw new eo({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}};async function tP({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function t$(e,t){let r,a;let n=e.getReader(),o=t.getReader(),s=!1,i=!1;async function l(e){try{null==r&&(r=n.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=o.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(s){await u(e);return}if(i){await l(e);return}null==r&&(r=n.read()),null==a&&(a=o.read());let{result:t,reader:p}=await Promise.race([r.then(e=>({result:e,reader:n})),a.then(e=>({result:e,reader:o}))]);t.done||e.enqueue(t.value),p===n?(r=void 0,t.done&&(await u(e),s=!0)):(a=void 0,t.done&&(i=!0,await l(e)))}catch(t){e.error(t)}},cancel(){n.cancel(),o.cancel()}})}(0,x.hK)({prefix:"aitxt",size:24}),(0,x.hK)({prefix:"msg",size:24}),b.bD,b.bD;var tU="AI_NoSuchProviderError",tq=`vercel.ai.error.${tU}`,tJ=Symbol.for(tq),tF=class extends b.eM{constructor({modelId:e,modelType:t,providerId:r,availableProviders:a,message:n=`No such provider: ${r} (available providers: ${a.join()})`}){super({errorName:tU,modelId:e,modelType:t,message:n}),this[v]=!0,this.providerId=r,this.availableProviders=a}static isInstance(e){return b.bD.hasMarker(e,tq)}};v=tJ;var tL="2024-11-05",tV=[tL,"2024-10-07"],tB=T.z.object({name:T.z.string(),version:T.z.string()}).passthrough(),tZ=T.z.object({_meta:T.z.optional(T.z.object({}).passthrough())}).passthrough(),tK=T.z.object({method:T.z.string(),params:T.z.optional(tZ)}),tG=T.z.object({experimental:T.z.optional(T.z.object({}).passthrough()),logging:T.z.optional(T.z.object({}).passthrough()),prompts:T.z.optional(T.z.object({listChanged:T.z.optional(T.z.boolean())}).passthrough()),resources:T.z.optional(T.z.object({subscribe:T.z.optional(T.z.boolean()),listChanged:T.z.optional(T.z.boolean())}).passthrough()),tools:T.z.optional(T.z.object({listChanged:T.z.optional(T.z.boolean())}).passthrough())}).passthrough(),tW=tZ.extend({protocolVersion:T.z.string(),capabilities:tG,serverInfo:tB,instructions:T.z.optional(T.z.string())}),tH=tZ.extend({nextCursor:T.z.optional(T.z.string())}),tX=T.z.object({name:T.z.string(),description:T.z.optional(T.z.string()),inputSchema:T.z.object({type:T.z.literal("object"),properties:T.z.optional(T.z.object({}).passthrough())}).passthrough()}).passthrough(),tQ=tH.extend({tools:T.z.array(tX)}),tY=T.z.object({type:T.z.literal("text"),text:T.z.string()}).passthrough(),t0=T.z.object({type:T.z.literal("image"),data:T.z.string().base64(),mimeType:T.z.string()}).passthrough(),t1=T.z.object({uri:T.z.string(),mimeType:T.z.optional(T.z.string())}).passthrough(),t2=t1.extend({text:T.z.string()}),t4=t1.extend({blob:T.z.string().base64()}),t7=T.z.object({type:T.z.literal("resource"),resource:T.z.union([t2,t4])}).passthrough(),t6=tZ.extend({content:T.z.array(T.z.union([tY,t0,t7])),isError:T.z.boolean().default(!1).optional()}).or(tZ.extend({toolResult:T.z.unknown()})),t8=T.z.object({jsonrpc:T.z.literal("2.0"),id:T.z.union([T.z.string(),T.z.number().int()])}).merge(tK).strict(),t3=T.z.object({jsonrpc:T.z.literal("2.0"),id:T.z.union([T.z.string(),T.z.number().int()]),result:tZ}).strict(),t9=T.z.object({jsonrpc:T.z.literal("2.0"),id:T.z.union([T.z.string(),T.z.number().int()]),error:T.z.object({code:T.z.number().int(),message:T.z.string(),data:T.z.optional(T.z.unknown())})}).strict(),t5=T.z.object({jsonrpc:T.z.literal("2.0")}).merge(T.z.object({method:T.z.string(),params:T.z.optional(tZ)})).strict(),re=T.z.union([t8,t5,t3,t9]),rt=class{constructor({url:e,headers:t}){this.connected=!1,this.url=new URL(e),this.headers=t}async start(){return new Promise((e,t)=>{if(this.connected)return e();this.abortController=new AbortController,(async()=>{var r,a,n;try{let n=new Headers(this.headers);n.set("Accept","text/event-stream");let o=await fetch(this.url.href,{headers:n,signal:null==(r=this.abortController)?void 0:r.signal});if(!o.ok||!o.body){let e=new tO({message:`MCP SSE Transport Error: ${o.status} ${o.statusText}`});return null==(a=this.onerror)||a.call(this,e),t(e)}let s=o.body.pipeThrough(new TextDecoderStream).pipeThrough(createEventSourceParserStream()).getReader(),i=async()=>{var r,a,n;try{for(;;){let{done:t,value:n}=await s.read();if(t){if(this.connected)throw this.connected=!1,new tO({message:"MCP SSE Transport Error: Connection closed unexpectedly"});return}let{event:o,data:i}=n;if("endpoint"===o){if(this.endpoint=new URL(i,this.url),this.endpoint.origin!==this.url.origin)throw new tO({message:`MCP SSE Transport Error: Endpoint origin does not match connection origin: ${this.endpoint.origin}`});this.connected=!0,e()}else if("message"===o)try{let e=re.parse(JSON.parse(i));null==(r=this.onmessage)||r.call(this,e)}catch(t){let e=new tO({message:"MCP SSE Transport Error: Failed to parse message",cause:t});null==(a=this.onerror)||a.call(this,e)}}}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(n=this.onerror)||n.call(this,e),t(e)}};this.sseConnection={close:()=>s.cancel()},i()}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;null==(n=this.onerror)||n.call(this,e),t(e)}})()})}async close(){var e,t,r;this.connected=!1,null==(e=this.sseConnection)||e.close(),null==(t=this.abortController)||t.abort(),null==(r=this.onclose)||r.call(this)}async send(e){var t,r,a;if(!this.endpoint||!this.connected)throw new tO({message:"MCP SSE Transport Error: Not connected"});try{let a=new Headers(this.headers);a.set("Content-Type","application/json");let n={method:"POST",headers:a,body:JSON.stringify(e),signal:null==(t=this.abortController)?void 0:t.signal},o=await fetch(this.endpoint,n);if(!o.ok){let e=await o.text().catch(()=>null),t=new tO({message:`MCP SSE Transport Error: POSTing to endpoint (HTTP ${o.status}): ${e}`});null==(r=this.onerror)||r.call(this,t);return}}catch(e){null==(a=this.onerror)||a.call(this,e);return}}};function rr(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,n){n.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function ra(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&ri(null==(r=e.data)?void 0:r.chunk,t);return}ri(e,t)}})).pipeThrough(rr(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue((0,S.H4)("text",e))}}))}function rn(e,t){return ra(e,t).pipeThrough(new TextEncoderStream)}function ro(e,t){var r;let a=ra(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),n=null==t?void 0:t.data,o=null==t?void 0:t.init;return new Response(n?t$(n.stream,a):a,{status:null!=(r=null==o?void 0:o.status)?r:200,statusText:null==o?void 0:o.statusText,headers:R(null==o?void 0:o.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function rs(e,t){t.dataStream.merge(ra(e,t.callbacks))}function ri(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function rl(e,t){let r;let a=(r=!0,e=>(r&&(e=e.trimStart())&&(r=!1),e));return(0,x.NR)(e[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(a(e.delta))}})).pipeThrough(rr(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue((0,S.H4)("text",e))}}))}function ru(e,t){return rl(e,t).pipeThrough(new TextEncoderStream)}function rp(e,t={}){var r;let{init:a,data:n,callbacks:o}=t,s=rl(e,o).pipeThrough(new TextEncoderStream);return new Response(n?t$(n.stream,s):s,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:R(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function rc(e,t){t.dataStream.merge(rl(e,t.callbacks))}j({},{mergeIntoDataStream:()=>rs,toDataStream:()=>rn,toDataStreamResponse:()=>ro}),j({},{mergeIntoDataStream:()=>rc,toDataStream:()=>ru,toDataStreamResponse:()=>rp})}}]);